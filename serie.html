<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Episódios da Série</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script defer src="serie.js"></script>
</head>
<body>
  <div class="container py-5">
    <h1 id="title" class="text-center mb-4">Episódios da Série</h1>
    <div class="list-group" id="episodes"></div>
  </div>


  <script>
    document.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id"); // Captura o ID da série da URL
  const titleElement = document.getElementById("title");
  const episodesContainer = document.getElementById("episodes");

  // Carrega os dados da série
  fetch("dados.json")
    .then(response => response.json())
    .then(data => {
      const series = data[id];
      if (series && series.type === "serie") {
        titleElement.innerText = `Episódios de ${series.title}`;
        renderEpisodes(series.episodes, id);
      } else {
        episodesContainer.innerHTML = "<p class='text-danger'>Série não encontrada.</p>";
      }
    });

  // Renderiza os episódios
  function renderEpisodes(episodes, seriesId) {
    episodesContainer.innerHTML = "";
    const watchedEpisodes = getWatchedEpisodes(seriesId);

    episodes.forEach((episodeUrl, index) => {
      const isWatched = watchedEpisodes.includes(index.toString());

      const episodeItem = `
        <div class="list-group-item d-flex justify-content-between align-items-center">
          <a href="${episodeUrl}" target="_blank">Episódio ${index + 1}</a>
          <button class="btn btn-${isWatched ? "success" : "secondary"} mark-watched" data-id="${index}">
            ${isWatched ? "Visto" : "Marcar como Visto"}
          </button>
        </div>`;
      episodesContainer.innerHTML += episodeItem;
    });

    // Adiciona evento para os botões "Marcar como Visto"
    document.querySelectorAll(".mark-watched").forEach(button => {
      button.addEventListener("click", () => {
        const episodeId = button.getAttribute("data-id");
        toggleWatchedEpisode(seriesId, episodeId);
        renderEpisodes(episodes, seriesId); // Re-renderiza os episódios
      });
    });
  }

  // Obter episódios vistos para uma série
  function getWatchedEpisodes(seriesId) {
    const watchedData = JSON.parse(localStorage.getItem("watchedEpisodes")) || {};
    return watchedData[seriesId] || [];
  }

  // Alterna o status de "visto" para um episódio
  function toggleWatchedEpisode(seriesId, episodeId) {
    const watchedData = JSON.parse(localStorage.getItem("watchedEpisodes")) || {};
    if (!watchedData[seriesId]) watchedData[seriesId] = [];

    const watchedEpisodes = watchedData[seriesId];
    if (watchedEpisodes.includes(episodeId)) {
      const index = watchedEpisodes.indexOf(episodeId);
      watchedEpisodes.splice(index, 1);
    } else {
      watchedEpisodes.push(episodeId);
    }

    watchedData[seriesId] = watchedEpisodes;
    localStorage.setItem("watchedEpisodes", JSON.stringify(watchedData));
  }
});

  </script>
</body>
</html>
